---
export const prerender = false;

import BaseLayout from '../../../layouts/BaseLayout.astro';
import { getLiveEntry } from 'astro:content';
import { LiveCollectionValidationError } from 'astro/content/runtime';
import { type Product } from '../../../loaders/products-loader';

const { slug } = Astro.params;
console.log("ğŸš€ ~ Product page ~ slug (server):", slug)

const { entry: productItem, error } = await getLiveEntry('products', { slug: slug ?? "" });
if (LiveCollectionValidationError.is(error)) {
  console.error("ğŸš€ ~ Product page ~ collection shema validation errors:", error)
} else if (error) {
  console.error("ğŸš€ ~ Product page ~ collection error:", error)
}

if (!productItem) {
  console.error("ğŸš€ ~ Product page ~ could not get product by slug:", slug)
}

// Keep selected product in Session
//Astro.session?.set('currentProduct', extractedProduct);
//const sessionProduct = await Astro.session?.get('currentProduct');

const extractedProduct: Product | undefined = productItem as unknown as Product;
console.log("ğŸš€ ~ Product page ~ data:", extractedProduct)
---

<script>
  const element = document.getElementById('my-element');
  const productSlug = element?.dataset.slug;
  console.log("ğŸš€ ~ Product page ~ slug (client):", productSlug)
</script>

<BaseLayout title=`ĞšĞ°Ñ‚Ğ°Ğ»Ğ¾Ğ³ - ${extractedProduct?.title}`>
    <div class="px-4" data-slug={slug} data-title={extractedProduct.title} data-category-id={extractedProduct.categoryId} data-category-slug={extractedProduct.categorySlug}>
      <span>Ğ¡Ñ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ğ° Ğ² Ñ€Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞµ...</span>
      <!-- <span>Ğ—Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ Ğ¿Ñ€Ğ¾Ğ´ÑƒĞºÑ‚Ğ° Ğ¸Ğ· ÑĞµÑÑĞ¸Ğ¸ {sessionProduct?.title}</span> -->
    </div>
</BaseLayout>