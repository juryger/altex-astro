---
export const prerender = false;

import BaseLayout from '../../../layouts/BaseLayout.astro';
import { getLiveEntry } from 'astro:content';
import { LiveCollectionValidationError } from 'astro/content/runtime';
import { setCurrentProduct } from "../../../core/stores/product-store";

const { slug } = Astro.params;
console.log("ğŸš€ ~ Product page ~ slug (server):", slug)

const { entry: productItem, error } = await getLiveEntry('products', { slug: slug ?? "" });
if (LiveCollectionValidationError.is(error)) {
  console.error("ğŸš€ ~ Product page ~ collection shema validation errors:", error)
} else if (error) {
  console.error("ğŸš€ ~ Product page ~ collection error:", error)
}

// Keep selected product in Session
//Astro.session?.set('currentProduct', extractedProduct);
//const sessionProduct = await Astro.session?.get('currentProduct');

const value = productItem?.data;
console.log("ğŸš€ ~ Product page ~ data:", value)
setCurrentProduct(value);
---

<script>
  // Get product data on client-side
  // const element = document.getElementById('product-card');
  // console.log("ğŸš€ ~ Product page ~ slug: %s", element?.dataset.slug);  
</script>

<BaseLayout title=`ĞšĞ°Ñ‚Ğ°Ğ»Ğ¾Ğ³ - ${value?.title}`>
    <div id="product-card" class="px-4" data-slug={value?.slug} data-id={value?.id} data-title={value?.title} data-categoryid={value?.categoryId} data-categoryslug={value?.categorySlug}>
      <span>Ğ¡Ñ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ğ° Ğ² Ñ€Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞµ...</span>
      <!-- <span>Ğ—Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ Ğ¿Ñ€Ğ¾Ğ´ÑƒĞºÑ‚Ğ° Ğ¸Ğ· ÑĞµÑÑĞ¸Ğ¸ {sessionProduct?.title}</span> -->
    </div>
</BaseLayout>