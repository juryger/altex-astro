---
import '../styles/global.css';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import Breadcrumbs from '../components/Breadcrumbs.astro';

const { title } = Astro.props;
const currentPath = Astro.url.pathname;
const MainTitle = `ĞĞ›Ğ¢Ğ•Ğ¥ - ${title}`;
---

<script>
  import { getWorkersFactory, type WorkerInfo } from "../factories/workers-factory";

	console.log("ğŸš€ ~ BaseLayout ~ obtain worker factory Catalog sync worker");
	window.workers = window.workers ?? {} as WorkerInfo;
	const factory = getWorkersFactory(window.workers);

	const catalogSyncWorker = factory.findOrCreateCatalogSyncWorker(
		e => {
			if (e.data) {
				console.log("ğŸš€ ~ BaseLayout ~ obtained response from catalog-sync-worker:", e.data);
			}
		}, err => {
			console.error("ğŸš€ ~ BaseLayout ~ error in catalog-sync-worker:", err.message);
		}
  );

	console.log("ğŸš€ ~ BaseLayout ~ sending command to catalog-sync-worker:", "sync_categories");
	catalogSyncWorker.postMessage(6);
</script>

<!doctype html>
<html lang="ru">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width" />
		<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
		<meta name="generator" content={Astro.generator} />
		<title>{MainTitle}</title>
	</head>
	<body>
		<Header />
		<Breadcrumbs currentPath={currentPath} />
		<div class="mx-auto max-w-7xl px-4 py-3">
			<slot />
		</div>
		<Footer />
	</body>
</html>
